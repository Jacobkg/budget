<h1><%= current_month %></h1>

<div id='credit-card-balance'>
  Credit Card Balance: <%= Account.balance("Credit Card").format %>
</div>
<div id='checking-balance'>
  Checking Balance: <%= Account.balance("Checking").format %>
</div>
<br>

<table id='line-items'>
  <tr>
    <th>Date</th>
    <th>Description</th>
    <th>Amount</th>
    <th>Category</th>
    <th>Account</th>
  </tr>
  <% LineItem.this_month.each do |line_item| %>
    <tr>
      <td><%= short_date(line_item.date) %></td>
      <td><%= line_item.description %></td>
      <td><%= line_item.amount.format %></td>
      <td><%= line_item.category %></td>
      <td><%= line_item.account %></td>
    </tr>
  <% end %>
</table>
<br>

<% if params[:account] == "Checking" %>
  <%= link_to "Credit Card Expense", root_url %>
  Checking Expense
<% else %>
  Credit Card Expense
  <%= link_to "Checking Expense", root_url(:account => "Checking") %>
<% end %>

<%= form_for(LineItem.new) do |f| %>
  <%= label_tag :date_string, "Date" %>
  <%= text_field_tag :date_string, short_date(Date.today), :autofocus => true %>
  <%= f.label :description %>
  <%= f.text_field :description%>
  <%= f.label :amount %>
  <%= f.text_field :amount %>
  <%= f.select :category, options_for_select(LineItem::CATEGORIES.map {|n| [n,n]}) %>
  <%= hidden_field_tag :account, (params[:account] || "Credit Card") %>
  <%= f.submit "Save" %>
<% end %>
<br>
<h2>Stats</h2>
<table id='category-stats'>
  <tr>
    <th>Category</th>
    <th>Spent</th>
  </tr>
  <% LineItem::CATEGORIES.each do |category| %>
    <tr>
      <td> <%= category %> </td>
      <td> <%= Money.parse(LineItem.this_month.where(:category => category).sum {|n| n.amount }).format %> </td>
    </tr>
  <% end %>
</table>